#!/usr/bin/env bash
set -Eeuo pipefail

##########################################################################
#  Neomnia â€” Script dâ€™installation & configuration systÃ¨me (Azure)        #
#  Licence : Charles Van den Driessche                                    #
#  Auteur  : @neomnia                                                     #
#  Repo    : https://github.com/charlesvdd/administrator-neomnia/tree/azure
#  Version : 2025-08-27
##########################################################################

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ðŸŽ¨ Couleurs & style (ANSI)
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
RED="\033[31m"; GREEN="\033[32m"; YELLOW="\033[33m"; BLUE="\033[34m"
MAGENTA="\033[35m"; CYAN="\033[36m"; BOLD="\033[1m"; RESET="\033[0m"

# BanniÃ¨re ASCII (ACSS ðŸ˜‰)
banner() {
  cat <<'EOF'
 _   _                           _           
| \ | | ___  _ __  _ __ ___   __| | ___ _ __ 
|  \| |/ _ \| '_ \| '__/ _ \ / _` |/ _ \ '__|
| |\  | (_) | | | | | | (_) | (_| |  __/ |   
|_| \_|\___/|_| |_|_|  \___/ \__,_|\___|_|   
            Administrator â€¢ Azure Setup
EOF
}

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ðŸ“ Logging (chaque ligne prÃ©fixÃ©e [Neomnia], horodatÃ©e, + fichier log)
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
LOGFILE="/var/log/neomnia-setup.log"
mkdir -p "$(dirname "$LOGFILE")" || true
touch "$LOGFILE" || true

_log_line() {
  # $1 = message dÃ©jÃ  colorÃ© Ã©ventuellement
  local ts
  ts="$(date '+%F %T')"
  # Ã‰crit stdout + fichier log (sans codes ANSI dans le fichier)
  echo -e "${CYAN}[Neomnia]${RESET} $1"
  # Stripping ANSI for logfile
  echo -e "[$ts] [Neomnia] $(echo -e "$1" | sed -r 's/\x1B\[[0-9;]*[mK]//g')" >> "$LOGFILE"
}

log()  { _log_line "$@"; }
ok()   { _log_line "${GREEN}âœ”${RESET} $*"; }
warn() { _log_line "${YELLOW}âš ${RESET} $*"; }
err()  { _log_line "${RED}âœ–${RESET} $*"; }

trap 'err "Une erreur est survenue (ligne ${BASH_LINENO[0]}). Consulter $LOGFILE."' ERR

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ðŸ›¡ï¸ PrÃ©requis & utilitaires
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
require_root() {
  if [[ "${EUID:-$(id -u)}" -ne 0 ]]; then
    err "Ce script doit Ãªtre exÃ©cutÃ© en root (sudo)."
    exit 1
  fi
}

require_cmd() {
  # usage: require_cmd curl jq
  for c in "$@"; do
    command -v "$c" >/dev/null 2>&1 || {
      err "Commande requise manquante: $c"
      exit 1
    }
  done
}

validate_hostname() {
  local h="$1"
  # rÃ¨gles simples host RFCâ€”lettres, chiffres, tirets, points; pas de tiret en dÃ©but/fin de label
  if [[ ! "$h" =~ ^([a-zA-Z0-9]([a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)(\.[a-zA-Z0-9]([a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$ ]]; then
    return 1
  fi
  return 0
}

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ðŸŒ Base RAW du dÃ©pÃ´t (branche azure) pour rÃ©cupÃ©rer des fichiers si besoin
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
GITHUB_OWNER="charlesvdd"
GITHUB_REPO="administrator-neomnia"
GITHUB_BRANCH="azure"
RAW_BASE="https://raw.githubusercontent.com/${GITHUB_OWNER}/${GITHUB_REPO}/${GITHUB_BRANCH}"

fetch_raw() {
  # usage: fetch_raw path/vers/fichier [/chemin/dest]
  local remote_path="$1"
  local dest="${2:-$(basename "$remote_path")}"
  log "TÃ©lÃ©chargement depuis le dÃ©pÃ´t (raw): ${BLUE}${RAW_BASE}/${remote_path}${RESET} â†’ ${dest}"
  curl -fsSL "${RAW_BASE}/${remote_path}" -o "$dest"
  ok "Fichier rÃ©cupÃ©rÃ©: $dest"
}

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ðŸš€ DÃ©but
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
require_root
banner | while IFS= read -r line; do log "$line"; done

# Sâ€™assurer quâ€™on est bien sous bash (au cas oÃ¹)
if [[ -z "${BASH_VERSION:-}" ]]; then
  log "Basculer vers bashâ€¦"
  exec bash "$0" "$@"
fi

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ðŸ“¦ Mises Ã  jour & paquets de base
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
log "Mise Ã  jour du systÃ¨meâ€¦"
export DEBIAN_FRONTEND=noninteractive
apt-get update -y >>"$LOGFILE" 2>&1
apt-get upgrade -y >>"$LOGFILE" 2>&1
ok "SystÃ¨me Ã  jour."

log "Installation des outils (curl, git, ufw, tree, wget, jq, acl)â€¦"
apt-get install -y curl git ufw tree wget jq acl >>"$LOGFILE" 2>&1
ok "Paquets installÃ©s."

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ðŸ–¥ï¸ Hostname
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
read -r -p "$(echo -e "${CYAN}[Neomnia]${RESET} Nom du nouvel hostname : ")" NEW_HOSTNAME
if ! validate_hostname "$NEW_HOSTNAME"; then
  err "Hostname invalide: $NEW_HOSTNAME"
  exit 1
fi
log "Configuration du hostname â†’ ${BOLD}$NEW_HOSTNAME${RESET}"
hostnamectl set-hostname "$NEW_HOSTNAME"
if grep -qE '^127\.0\.1\.1' /etc/hosts; then
  sed -i "s/^127\.0\.1\.1.*/127.0.1.1\t$NEW_HOSTNAME/" /etc/hosts
else
  echo -e "127.0.1.1\t$NEW_HOSTNAME" >> /etc/hosts
fi
echo "$NEW_HOSTNAME" > /etc/hostname
ok "Hostname configurÃ©."

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ðŸ‘¥ Groupe + ACL sur /opt
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
read -r -p "$(echo -e "${CYAN}[Neomnia]${RESET} Nom du groupe (dÃ©faut gitusers) : ")" GROUP_NAME
GROUP_NAME="${GROUP_NAME:-gitusers}"
if getent group "$GROUP_NAME" >/dev/null; then
  warn "Groupe ${GROUP_NAME} dÃ©jÃ  existant."
else
  groupadd "$GROUP_NAME"
  ok "Groupe ${GROUP_NAME} crÃ©Ã©."
fi

# DÃ©tecter lâ€™utilisateur Azure par dÃ©faut si prÃ©sent
AZ_USER=""
for u in azureuser admin ubuntu; do
  id "$u" >/dev/null 2>&1 && AZ_USER="$u" && break
done
if [[ -n "$AZ_USER" ]]; then
  usermod -a -G "$GROUP_NAME" "$AZ_USER"
  ok "Utilisateur $AZ_USER ajoutÃ© au groupe ${GROUP_NAME}."
else
  warn "Aucun utilisateur 'azureuser/admin/ubuntu' dÃ©tectÃ© â€” saute lâ€™ajout au groupe."
fi

# Droits & ACL rÃ©currents sur /opt
mkdir -p /opt
chown -R root:"$GROUP_NAME" /opt
chmod -R 2775 /opt
setfacl -R -m g:"$GROUP_NAME":rwx /opt
setfacl -dR -m g:"$GROUP_NAME":rwx /opt
ok "Droits rÃ©cursifs & ACL appliquÃ©s sur /opt pour ${GROUP_NAME}."

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ðŸ”¥ Pare-feu UFW
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
log "Configuration du pare-feu UFWâ€¦"
ufw allow OpenSSH >>"$LOGFILE" 2>&1 || true
# (optionnel) ouvrir HTTP/HTTPS maintenant, sinon commente les deux lignes suivantes
# ufw allow 80/tcp >>"$LOGFILE" 2>&1 || true
# ufw allow 443/tcp >>"$LOGFILE" 2>&1 || true
ufw --force enable >>"$LOGFILE" 2>&1 || ufw status verbose >>"$LOGFILE" 2>&1
ok "Pare-feu activÃ©."

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ðŸ§° Git config + vÃ©rification GitHub API & scopes
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
read -r -p "$(echo -e "${CYAN}[Neomnia]${RESET} Email Git : ")" GIT_EMAIL
read -r -p "$(echo -e "${CYAN}[Neomnia]${RESET} Nom Git (user.name) : ")" GIT_CONF_USERNAME
git config --global user.email "$GIT_EMAIL"
git config --global user.name "$GIT_CONF_USERNAME"
ok "Configuration Git appliquÃ©e."

read -r -p "$(echo -e "${CYAN}[Neomnia]${RESET} GitHub username : ")" GITHUB_USERNAME
read -r -s -p "$(echo -e "${CYAN}[Neomnia]${RESET} GitHub API token (masquÃ©) : ")" GITHUB_API_KEY
echo

require_cmd curl jq

log "VÃ©rification de lâ€™authentification GitHubâ€¦"
# On rÃ©cupÃ¨re headers (scopes) + body
GH_RESP_HEADERS="$(mktemp)"
GH_RESP_BODY="$(mktemp)"
curl -fsSL -D "$GH_RESP_HEADERS" -H "Authorization: token $GITHUB_API_KEY" https://api.github.com/user -o "$GH_RESP_BODY" || {
  err "Connexion Ã  lâ€™API GitHub impossible."
  exit 1
}
USER_LOGIN="$(jq -r '.login // empty' < "$GH_RESP_BODY")"
if [[ -z "$USER_LOGIN" ]]; then
  err "Impossible de valider la clÃ© API GitHub (login vide)."
  cat "$GH_RESP_BODY" >>"$LOGFILE"
  exit 1
fi
ok "Connexion GitHub OK â†’ ${BOLD}$USER_LOGIN${RESET}"

# Lire les scopes depuis les headers
GH_SCOPES="$(grep -i '^x-oauth-scopes:' "$GH_RESP_HEADERS" | cut -d':' -f2- | sed 's/^[[:space:]]*//')"
if [[ -z "${GH_SCOPES// /}" ]]; then
  warn "Aucun scope dÃ©tectÃ© dans les headers. (Token fine-grained ? GitHub peut masquer les scopes.)"
else
  log "Scopes dÃ©tectÃ©s: ${MAGENTA}${GH_SCOPES}${RESET}"
fi
rm -f "$GH_RESP_HEADERS" "$GH_RESP_BODY"

# VÃ©rification simple de scopes utiles (indicatif)
NEEDED=("repo" "workflow")
MISSING=()
for s in "${NEEDED[@]}"; do
  if [[ "$GH_SCOPES" != *"$s"* ]]; then
    MISSING+=("$s")
  fi
done
if ((${#MISSING[@]})); then
  warn "Scopes manquants (indicatif): ${MISSING[*]} â€” confirme dans GitHub si nÃ©cessaire."
else
  ok "Scopes essentiels prÃ©sents (ou token fine-grained adÃ©quat)."
fi

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ðŸ§© (Optionnel) Exemple dâ€™usage du RAW de ton dÃ©pÃ´t
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Ex.: rÃ©cupÃ©rer un script commun depuis /scripts/bootstrap.sh
# if curl --head --silent --fail "${RAW_BASE}/scripts/bootstrap.sh" >/dev/null; then
#   fetch_raw "scripts/bootstrap.sh" "/usr/local/bin/neomnia-bootstrap"
#   chmod +x /usr/local/bin/neomnia-bootstrap
#   ok "Bootstrap installÃ©: /usr/local/bin/neomnia-bootstrap"
# else
#   warn "scripts/bootstrap.sh introuvable sur la branche ${GITHUB_BRANCH}."
# fi

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# âœ… VÃ©rification finale
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
echo -e "\n${MAGENTA}${BOLD}############## VÃ©rification finale ##############${RESET}"
[[ -n "${NEW_HOSTNAME:-}" ]] && ok "Hostname configurÃ© â†’ ${NEW_HOSTNAME}"
[[ -n "${GROUP_NAME:-}"   ]] && ok "Groupe ${GROUP_NAME} appliquÃ© Ã  /opt (ACL activÃ©es)."
[[ -n "${USER_LOGIN:-}"   ]] && ok "GitHub API valide pour ${USER_LOGIN}"
ok "Journal : ${LOGFILE}"
echo -e "${MAGENTA}${BOLD}##############   Setup complet   ##############${RESET}\n"
